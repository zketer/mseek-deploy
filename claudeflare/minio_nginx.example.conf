# MinIO Nginx 配置文件示例
# 用于代理 MinIO API 和控制台
# 安装路径: /etc/nginx/conf.d/minio.conf
# 注意: 请将域名替换为您的实际域名

# MinIO API 代理 (端口 9000)
server {
    listen 80;
    server_name your_minio_api_domain;  # 替换为您的MinIO API域名

    # 启用 gzip
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # 客户端最大上传大小（MinIO 可能需要上传大文件）
    client_max_body_size 1000M;
    client_body_buffer_size 512k;

    # 代理到 MinIO API
    location / {
        proxy_pass http://localhost:9000;

        # 代理请求头
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;

        # WebSocket 支持（如果需要）
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # 超时设置
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 300;

        # 缓冲设置
        proxy_buffering off;
        proxy_request_buffering off;
    }

    # 健康检查端点
    location /minio/health/live {
        proxy_pass http://localhost:9000/minio/health/live;
        access_log off;
    }
}

# MinIO Console 代理 (端口 9001)
server {
    listen 80;
    server_name your_minio_console_domain;  # 替换为您的MinIO控制台域名

    # 启用 gzip
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # 客户端最大上传大小
    client_max_body_size 100M;

    # 代理到 MinIO Console
    location / {
        proxy_pass http://localhost:9001;

        # 代理请求头
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;

        # WebSocket 支持（MinIO Console 需要）
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # 超时设置
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 300;

        # 缓冲设置
        proxy_buffering off;
        proxy_request_buffering off;
    }
}
